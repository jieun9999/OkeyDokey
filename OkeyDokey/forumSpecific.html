<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>forumSpecific</title>
    <!--폰트 적용-->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Varela+Round">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kalam:wght@300;400;700&family=Noto+Sans+KR:wght@300&family=Open+Sans:ital@1&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <!-- 가장기본이 되는 css 코드-->
    <link rel="stylesheet" href="../bootstrap-4.6.2-dist/css/bootstrap.css">
    <link rel="stylesheet" href="forumSpecific.css">
</head>
<body>
    <?php
    // PHP 코드를 여기에 작성합니다.
    //이렇게 하면 브라우저에 에러 메시지가 표시됩니다. 
    error_reporting(E_ALL);
    ini_set('display_errors', 1);
    //

    //1. mysql과 연결하기
    $host = '52.79.41.79';
    $user = 'datagrip';
    $pw = 'abc123';
    $db_name = 'mydb';

    $connect = mysqli_connect($host, $user, $pw, $db_name);

    if ($connect->connect_error) {
        die("Connection failed: " . $connect->connect_error);
    }

    //2. GET 요청으로 forumId 가져오기 
    //isset 함수를 사용하여 해당 매개변수가 있는지 확인하고, 있다면 $forumId 변수에 할당합니다.
    
    $forumId = isset($_GET['글아이디']) ? $_GET['글아이디'] : null;

    
    // 조회수 업데이트 하는 쿼리 생성함
    // forums 테이블의 forumHits 칼럼이 +1 씩 증가함
    $updateForumHitsSql = "UPDATE forums SET forumHits = forumHits + 1
                          WHERE forumId =  $forumId";

    $connect->query($updateForumHitsSql);                      


    //3. 쿼리문으로 데이터 가져오기
    $sql = "SELECT forumTitle, forumContents, forumDate, forumHits, forumVotingCounts,
            users.userName, users.userImg,
            answers.answerContents, answers.answerDate, answers.answerVotingCounts,
            users2.userName AS answerUserName, users2.userImg AS answerUserImg
            FROM forums 
            LEFT JOIN answers ON forums.forumId = answers.forumId
            LEFT JOIN users ON forums.userId = users.userId
            LEFT JOIN users AS users2 ON answers.userId = users2.userId /* users테이블 겹치니까 별칭사용함 */
            WHERE forums.forumId = $forumId";

    $result=$connect->query($sql);
    $rows=mysqli_fetch_assoc($result);
     
    ?>

    <!--따온 코드 넣기-->
    <!-- Header-->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
         <!-- Logo -->
    <a class="navbar-brand" href="#">
        <img src="../img/okeydokey1.png" class="h-8" alt="...">
      </a>
        <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarCollapse">
            <span class="navbar-toggler-icon"></span>
        </button>
        <!-- Collection of nav links, forms, and other content for toggling -->
        <div id="navbarCollapse" class="collapse navbar-collapse justify-content-start">
            <class class="navbar-nav">
                <a href="#" class="nav-item nav-link">Home</a>
                <a href="#" class="nav-item nav-link">About</a>			
                <a href="#" class="nav-item nav-link active">Pricing</a>
                <a href="#" class="nav-item nav-link">Blog</a>
                <a href="#" class="nav-item nav-link">Contact</a>
                <form class="navbar-form form-inline">
                    <div class="input-group search-box">								
                        <input type="text" id="search" class="form-control" placeholder="Search here...">
                        <div class="input-group-append">
                            <span class="input-group-text">
                                <i class="material-icons">&#xE8B6;</i>
                            </span>
                        </div>
                    </div>
                </form>
                </class>
            </div>
            <div class="navbar-nav ml-auto action-buttons"
                <div class="nav-item dropdown">
                    <a href="#" data-toggle="dropdown" class="nav-link dropdown-toggle mr-4">Login</a>
                </div>
                <div class="nav-item dropdown">
                    <a href="#" data-toggle="dropdown" class="btn btn-primary sign-up-btn">Sign up</a>
                </div>
            </div>
        </div>
    </nav>

                
    <!-- Main-->
    <div class="container-fluid mt-100 forum-container">
                  <!-- 목록으로, 수정, 삭제 버튼-->
                  <div class="buttons-forums-container">
                    <div class="buttons-forums">
                      <button type="button" class="btn btn-light">목록으로</button>
                      <button type="button" class="btn btn-dark">수정</button>
                      <button type="button" class="btn btn-danger">삭제</button>
                    </div>
                  </div>
      <div class="row">
          <div class="col-md-12">
              <div class="card mb-4">
                  <div class="card-header">
                      <div class="media flex-wrap w-100 align-items-center"> <img src="<?php echo $rows['userImg']?>" class="d-block ui-w-40 rounded-circle fixed-size-image" alt="">
                          <div class="media-body ml-3"> 
                            <div class="title"><?php echo $rows['forumTitle']?></div>
                            <div class="text-muted small">
                              <div><?php echo $rows['userName']?></div>
                            </div>
                          </div>
                          <div class="text-muted small ml-3">
                            <div><?php echo $rows['forumDate']?></div>
                            <div class="hits"> <i class="fa fa-eye text-muted fsize-3"></i>&nbsp;<?php echo $rows['forumHits']?></div>
                          </div>
                      </div>
                  </div>
                  <div class="card-body">
                    <div class = "box vote-box">
                      <div class = "up">&#9650;</div>
                      <div class = "voteNum"><?php echo $rows['forumVotingCounts']?></div>
                      <div class = "down">&#9660;</div>
                    </div>
                    <div class= "card-text">
                        <?php echo $rows['forumContents']?>
                    </div>
                  </div>
                  <div class="card-footer d-flex flex-wrap justify-content-between align-items-center px-0 pt-0 pb-3">
                      <div class="px-4 pt-3"> <button type="button" class="btn btn-primary"><i class="fa fa-reply"></i> Reply</button> </div>
                  </div>
              </div>
          </div>
      </div>
  </div>

  <!-- answer 작성폼-->
  <div class="answer-post-form">
    <div class="post-form-border"">
        <textarea class="textarea" placeholder="Add your replies here..."></textarea>  
        <div class=""> <button type="button" class="btn btn-success">Submit Reply</button>
        </div>   
    </div>   
</div>

<!-- answerContents가 있으면 답변 ui 보이고, 없으면 안보이게 -->
<?php if($rows['answerContents'] != null): ?>
  <!--answer 부분-->
  <div class="container answer-container">
    <div class="card">
        <div class="card-body card-answers">
            <div class="row answer-total-box">
                <div class=" answer-profile">
                  <div class = "box vote-box vote-box-margin">
                    <div class = "up">&#9650;</div>
                    <div class = "voteNum"><?php echo $rows['answerVotingCounts']?></div>
                    <div class = "down">&#9660;</div>
                  </div>
                  <div class="answer-date-box">
                    <img class="answer-user-img" src="<?php echo $rows['answerUserImg']?>" class="img img-rounded img-fluid"/>
                    <div class="text-secondary text-center answerDate"><?php echo $rows['answerDate']?></div></div>
                  </div>
                </div>
                <div class="answer-content-box">
                    <p>
                        <a class="float-left" href="https://maniruzzaman-akash.blogspot.com/p/contact.html"><strong><?php echo $rows['answerUserName']?></strong></a>
                        <span class="float-right"><i class="text-warning fa fa-star"></i></span>
                          <span class="float-right"><i class="text-warning fa fa-star"></i></span>
                        <span class="float-right"><i class="text-warning fa fa-star"></i></span>
                        <span class="float-right"><i class="text-warning fa fa-star"></i></span>
                   </p>
                   <div class="clearfix"></div>
                    <div class="answerContents"><?php echo $rows['answerContents']?></div>
                        <a class="float-right btn btn-outline-primary ml-2"> <i class="fa fa-reply"></i> Reply</a>
                </div>
            </div>
              <div class="card card-inner">
                <div class="media">
                  <div class="media-body comment-contents">
                    Will you do the same for me? It's time to face the music I'm no longer your muse. Heard it's beautiful, be the judge and my girls gonna take a vote. I can feel a phoenix inside of me. Heaven is jealous of our love, angels are crying from up above. Yeah, you take me to utopia.
                  </div>
                </div>
                <div class="comment-profile">
                  <div class="comment-date">2022</div>
                  <div class="author">author</div>
                </div>
                </div>
        </div>
    </div>
    <?php else: ?>
    <?php endif; ?>
  </div>

   <!-- Footer-->
  <footer class="footer_area section_padding_130_0">
          <div class="container">
            <div class="row">
              <!-- Single Widget-->
              <div class="col-12 col-sm-6 col-lg-4">
                <div class="single-footer-widget section_padding_0_130">
                  <!-- Footer Logo-->
                  <div class="footer-logo mb-3"></div>
                  <p>Appland is completely creative, lightweight, clean app landing page.</p>
                  <!-- Copywrite Text-->
                  <div class="copywrite-text mb-5">
                    <p class="mb-0">Made with <i class="lni-heart mr-1"></i>by<a class="ml-1" href="https://wrapbootstrap.com/user/DesigningWorld">Designing World</a></p>
                  </div>
                  <!-- Footer Social Area-->
                  <div class="footer_social_area"><a href="#" data-toggle="tooltip" data-placement="top" title="" data-original-title="Facebook"><i class="fa fa-facebook"></i></a><a href="#" data-toggle="tooltip" data-placement="top" title="" data-original-title="Pinterest"><i class="fa fa-pinterest"></i></a><a href="#" data-toggle="tooltip" data-placement="top" title="" data-original-title="Skype"><i class="fa fa-skype"></i></a><a href="#" data-toggle="tooltip" data-placement="top" title="" data-original-title="Twitter"><i class="fa fa-twitter"></i></a></div>
                </div>
              </div>
              <!-- Single Widget-->
              <div class="col-12 col-sm-6 col-lg">
                <div class="single-footer-widget section_padding_0_130">
                  <!-- Widget Title-->
                  <h5 class="widget-title">About</h5>
                  <!-- Footer Menu-->
                  <div class="footer_menu">
                    <ul>
                      <li><a href="#">About Us</a></li>
                      <li><a href="#">Corporate Sale</a></li>
                      <li><a href="#">Terms &amp; Policy</a></li>
                      <li><a href="#">Community</a></li>
                    </ul>
                  </div>
                </div>
              </div>
              <!-- Single Widget-->
              <div class="col-12 col-sm-6 col-lg">
                <div class="single-footer-widget section_padding_0_130">
                  <!-- Widget Title-->
                  <h5 class="widget-title">Support</h5>
                  <!-- Footer Menu-->
                  <div class="footer_menu">
                    <ul>
                      <li><a href="#">Help</a></li>
                      <li><a href="#">Support</a></li>
                      <li><a href="#">Privacy Policy</a></li>
                      <li><a href="#">Term &amp; Conditions</a></li>
                      <li><a href="#">Help &amp; Support</a></li>
                    </ul>
                  </div>
                </div>
              </div>
              <!-- Single Widget-->
              <div class="col-12 col-sm-6 col-lg">
                <div class="single-footer-widget section_padding_0_130">
                  <!-- Widget Title-->
                  <h5 class="widget-title">Contact</h5>
                  <!-- Footer Menu-->
                  <div class="footer_menu">
                    <ul>
                      <li><a href="#">Call Centre</a></li>
                      <li><a href="#">Email Us</a></li>
                      <li><a href="#">Term &amp;Conditions</a></li>
                      <li><a href="#">Help Center</a></li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
  </footer>

    </script>
    <!--script-->
    <!--jQuery는 bootstrap의 js가 사용하므로 bootstrap js 파일 로드 전 로드한다.-->
    <script src="../jQuery/jquery-3.7.1.js"></script>
    <!-- <body> 태그가 끝나기 전 js 파일 로드 시 웹 페이지 로딩 속도 향상된다.-->
    <script src="../bootstrap-4.6.2-dist/js/bootstrap.js"></script>
</body>
</html>