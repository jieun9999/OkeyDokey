<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>forumList</title>
        <!--Ìè∞Ìä∏ Ï†ÅÏö©-->
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Varela+Round">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Kalam:wght@300;400;700&family=Noto+Sans+KR:wght@300&family=Open+Sans:ital@1&display=swap" rel="stylesheet">
        <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <!-- Í∞ÄÏû•Í∏∞Î≥∏Ïù¥ ÎêòÎäî css ÏΩîÎìú-->
    <link rel="stylesheet" href="../bootstrap-4.6.2-dist/css/bootstrap.css">
    <link rel="stylesheet" href="forumList.css">
</head>
<body>
  <?php
  // PHP ÏΩîÎìúÎ•º Ïó¨Í∏∞Ïóê ÏûëÏÑ±Ìï©ÎãàÎã§.
  //Ïù¥Î†áÍ≤å ÌïòÎ©¥ Î∏åÎùºÏö∞Ï†ÄÏóê ÏóêÎü¨ Î©îÏãúÏßÄÍ∞Ä ÌëúÏãúÎê©ÎãàÎã§. 
  error_reporting(E_ALL);
  ini_set('display_errors', 1);
  //

  //1. mysqlÍ≥º Ïó∞Í≤∞ÌïòÍ∏∞
  include 'config.php';
  
  //2. SELECT ÏøºÎ¶¨ Ï†ÑÏÜ° 
  /* joinÏÇ¨Ïö©Ìï¥ÏÑú forums ÌÖåÏù¥Î∏îÍ≥º answers ÌÖåÏù¥Î∏îÏùò Îç∞Ïù¥ÌÑ∞Î•º ÌïúÎ≤àÏóê Í∞ÄÏ†∏Ïò®Îã§ */

  $sql = "SELECT forums.forumTitle, forums.userId, forums.forumDate, forums.forumId AS FI, /*forums.forumIdÎäî ÏïÑÎûòÏóêÏÑú Î†åÎçîÎßÅÌï¥ÏïºÌïòÎãà Î≥ÑÏπ≠ Ï†ïÌï¥Ï§å */
  answers.userId, answers.answerDate, users.userImg, users.userName, users2.userName AS forumUserName,
 /* ÏÑúÎ∏åÏøºÎ¶¨ COUNT Ìï®ÏàòÎ•º ÏÇ¨Ïö©Ìï¥ÏÑú forumIdÏóê ÎåÄÌïú answers ÌÖåÏù¥Î∏îÏùò ÌñâÏùò Í∞ØÏàò Í∞ÄÏ†∏Ïò§Í∏∞ */
  (
    SELECT COUNT(*)
    FROM answers
    WHERE answers.forumId = forums.forumId
  ) AS answerCount

  /* ÌïúÏ™Ω ÌÖåÏù¥Î∏î(answers)Í∞Ä ÏóÜÎäî Í≤ΩÏö∞ÏóêÎèÑ Î†åÎçîÎßÅ Îê† Ïàò ÏûàÎèÑÎ°ù LEFT JOIN ÏÇ¨Ïö©ÌïòÍ∏∞ */
        FROM forums 
        LEFT JOIN answers ON forums.forumId = answers.forumId
        LEFT JOIN users ON answers.userId = users.userId 
        JOIN users AS users2 ON forums.userId = users2.userId /* usersÌÖåÏù¥Î∏î Í≤πÏπòÎãàÍπå Î≥ÑÏπ≠ÏÇ¨Ïö©Ìï® */
        ORDER BY forums.forumDate DESC"; /* ÎÇ¥Î¶ºÏ∞®ÏàúÏúºÎ°ú Í∏ÄÎ™©Î°ù Î≤àÌò∏ Í∞ÄÏ†∏Ïò¥ */

  $result=$connect->query($sql);

  ?>
    <!--Îî∞Ïò® ÏΩîÎìú ÎÑ£Í∏∞-->
    <!-- Header-->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
         <!-- Logo -->
    <a class="navbar-brand" href="http://52.79.41.79/OkeyDokey/forumList.html">
        <img src="../img/okeydokey1.png" class="h-8" alt="..">
      </a>
        <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarCollapse">
            <span class="navbar-toggler-icon"></span>
        </button>
        <!-- Collection of nav links, forms, and other content for toggling -->
        <div id="navbarCollapse" class="collapse navbar-collapse justify-content-start">
            <class class="navbar-nav">
                <a href="#" class="nav-item nav-link">Home</a>
                <a href="#" class="nav-item nav-link">About</a>			
                <a href="#" class="nav-item nav-link active">Pricing</a>
                <a href="#" class="nav-item nav-link">Blog</a>
                <a href="#" class="nav-item nav-link">Contact</a>
                <form class="navbar-form form-inline">
                    <div class="input-group search-box">								
                        <input type="text" id="search" class="form-control" placeholder="Search here...">
                        <div class="input-group-append">
                            <span class="input-group-text">
                                <i class="material-icons">&#xE8B6;</i>
                            </span>
                        </div>
                    </div>
                </form>
                </class>
            </div>
            <div class="navbar-nav ml-auto action-buttons">
                <div class="nav-item dropdown" onclick="goToSignin()">
                    <a href="#" data-toggle="dropdown" class="nav-link dropdown-toggle mr-4">Login</a>
                </div>
                <div class="nav-item dropdown" onclick="goToSignup()">
                    <a href="#" data-toggle="dropdown" class="btn btn-primary dropdown-toggle sign-up-btn">Sign up</a>
                </div>
            </div>
        </div>
    </nav>
    <!-- Main-->
    <div class="container-fluid mt-100">
      <div class="d-flex flex-wrap justify-content-between">
      <button type="button" class="btn btn-shadow btn-wide btn-primary" id="newThreadBtn"> 
        <div class="newThreadBtnTxt"><i class="fa fa-plus fa-w-20"></i> New thread</div>
      </button>
      <div class="col-12 col-md-3 p-0 mb-3"> <input type="text" class="form-control" placeholder="Search..."> </div>
      </div>

      <div class="card mb-3">
      <div class="card-header pl-0 pr-0">
      <div class="row no-gutters w-100 align-items-center">
      <div class="col ml-3">Topics</div>
      <div class="col-4 text-muted">
      <div class="row no-gutters align-items-center">
      <div class="col-4">Answers</div>
      <div class="col-8">Last update</div>
      </div>
      </div>
      </div>
      </div>

      <!--dbÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò¥-->
      <?php
      //3. Í∞ÄÏ†∏Ïò® Îç∞Ïù¥ÌÑ∞Î°ú Î™©Ï∞® ÏÉùÏÑ±

      //while Î∞òÎ≥µÎ¨∏ÏùÄ mysql Í≤∞Í≥º ÏßëÌï©ÏóêÏÑú Í∞Å ÌñâÏùÑ ÌïòÎÇòÏî© Í∞ÄÏ†∏ÏôÄÏÑú html Î™©Ï∞®Î•º ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Ìï©ÎãàÎã§.
      //Ïù¥Îïå, 'fetch_assoc()' Ìï®ÏàòÎ•º ÌÜµÌï¥  MySQL Í≤∞Í≥º ÏßëÌï©Ïùò Ìïú ÌñâÏùÑ Ïó∞Í¥ÄÎ∞∞Ïó¥(associative array)Î°ú Í∞ÄÏ†∏ÏòµÎãàÎã§
      
      while($rows = mysqli_fetch_assoc($result)){
        ?>
        <div class="card-body py-3">
        <div class="row no-gutters align-items-center">
        <div class="col">
          <!-- Ïù¥Îïå, ?Îí§Ïùò ÌååÎùºÎØ∏ÌÑ∞Ïùò ÌÇ§Îäî Î¨¥Ï°∞Í±¥ Ïú†ÏùºÌï¥Ïïº ÌïúÎã§. Îî∞ÎùºÏÑú ÌïúÎ≤àÏì¥ Îã®Ïñ¥Ïù∏ forumIdÎäî Ïì∞ÏßÄ ÏïäÎèÑÎ°ù ÌïúÎã§! -->
          <a href="http://52.79.41.79/OkeyDokey/forumSpecific.html?Í∏ÄÏïÑÏù¥Îîî=<?php echo $rows['FI']?>" class="text-big" data-abc="true"><?php echo $rows['forumTitle']?></a>
          <!--forums ÌÖåÏù¥Î∏îÏùò userId ÌñâÏùò userNameÏù¥ Îì§Ïñ¥Í∞ÄÏïº Ìï®-->
        <div class="text-muted small mt-1">Started <?php echo $rows['forumDate']?> &nbsp;¬∑&nbsp; <a href="javascript:void(0)" class="text-muted" data-abc="true"><?php echo $rows['forumUserName']?></a></div>
        </div>
        <div class="d-none d-md-block col-4">
        <div class="row no-gutters align-items-center">
          <!-- answerCount Î∂ÄÎ∂ÑÏùÄ Í∞Å forumIdÏóê ÎåÄÌïú answers ÌÖåÏù¥Î∏î ÌñâÏùò Í∞ØÏàòÎ•º ÏùòÎØ∏ÌïúÎã§-->
        <div class="col-4"><?php echo $rows['answerCount']?></div>
          <!-- answerCountÍ∞Ä 0Î≥¥Îã§ ÌÅ¨Î©¥, ÎãµÎ≥ÄÏûêÏùò ÌîÑÎ°úÌïÑÏù¥ Î≥¥Ïù¥ÎèÑÎ°ù, ÎãµÎ≥ÄxÏù∏ Í≤ΩÏö∞ÏóêÎäî waiting for Ï∂úÎ†• -->
        <?php if($rows['answerCount'] > 0): ?>
        <div class="media col-8 align-items-center"> <img src="<?php echo $rows['userImg']?>" alt="" class="d-block ui-w-30 rounded-circle">
        <div class="media-body flex-truncate ml-2">
        <div class="line-height-1 text-truncate"><?php echo $rows['answerDate']?></div>
        <div class="text-muted small text-truncate">by <?php echo $rows['userName']?></div>
        </div>
        </div>
        <?php else: ?>
          <!-- $rows['answerCount']Í∞Ä nullÏù∏ Í≤ΩÏö∞ "waiting for you!" Ï∂úÎ†• -->
          <div class="media col-8 align-items-center"> <img src="<?php echo $rows['userImg']?>" alt="" class="d-block ui-w-30 rounded-circle">
            waiting for you! ü§Ø
            </div>
          <?php endif; ?>
        </div>
        </div>
        </div>
        </div>
        <hr class="m-0">
        <?php
      }
        // MySQL Ïó∞Í≤∞ Îã´Í∏∞
        $connect->close();
      ?>

      </div>
      <nav>
      <ul class="pagination mb-5">
      <li class="page-item disabled"><a class="page-link" href="javascript:void(0)" data-abc="true">¬´</a></li>
      <li class="page-item active"><a class="page-link" href="javascript:void(0)" data-abc="true">1</a></li>
      <li class="page-item"><a class="page-link" href="javascript:void(0)" data-abc="true">2</a></li>
      <li class="page-item"><a class="page-link" href="javascript:void(0)" data-abc="true">3</a></li>
      <li class="page-item"><a class="page-link" href="javascript:void(0)" data-abc="true">¬ª</a></li>
      </ul>
      </nav>
      </div> 
    <!-- Footer-->

    <footer class="footer_area section_padding_130_0">
          <div class="container">
            <div class="row">
              <!-- Single Widget-->
              <div class="col-12 col-sm-6 col-lg-4">
                <div class="single-footer-widget section_padding_0_130">
                  <!-- Footer Logo-->
                  <div class="footer-logo mb-3"></div>
                  <p>Appland is completely creative, lightweight, clean app landing page.</p>
                  <!-- Copywrite Text-->
                  <div class="copywrite-text mb-5">
                    <p class="mb-0">Made with <i class="lni-heart mr-1"></i>by<a class="ml-1" href="https://wrapbootstrap.com/user/DesigningWorld">Designing World</a></p>
                  </div>
                  <!-- Footer Social Area-->
                  <div class="footer_social_area"><a href="#" data-toggle="tooltip" data-placement="top" title="" data-original-title="Facebook"><i class="fa fa-facebook"></i></a><a href="#" data-toggle="tooltip" data-placement="top" title="" data-original-title="Pinterest"><i class="fa fa-pinterest"></i></a><a href="#" data-toggle="tooltip" data-placement="top" title="" data-original-title="Skype"><i class="fa fa-skype"></i></a><a href="#" data-toggle="tooltip" data-placement="top" title="" data-original-title="Twitter"><i class="fa fa-twitter"></i></a></div>
                </div>
              </div>
              <!-- Single Widget-->
              <div class="col-12 col-sm-6 col-lg">
                <div class="single-footer-widget section_padding_0_130">
                  <!-- Widget Title-->
                  <h5 class="widget-title">About</h5>
                  <!-- Footer Menu-->
                  <div class="footer_menu">
                    <ul>
                      <li><a href="#">About Us</a></li>
                      <li><a href="#">Corporate Sale</a></li>
                      <li><a href="#">Terms &amp; Policy</a></li>
                      <li><a href="#">Community</a></li>
                    </ul>
                  </div>
                </div>
              </div>
              <!-- Single Widget-->
              <div class="col-12 col-sm-6 col-lg">
                <div class="single-footer-widget section_padding_0_130">
                  <!-- Widget Title-->
                  <h5 class="widget-title">Support</h5>
                  <!-- Footer Menu-->
                  <div class="footer_menu">
                    <ul>
                      <li><a href="#">Help</a></li>
                      <li><a href="#">Support</a></li>
                      <li><a href="#">Privacy Policy</a></li>
                      <li><a href="#">Term &amp; Conditions</a></li>
                      <li><a href="#">Help &amp; Support</a></li>
                    </ul>
                  </div>
                </div>
              </div>
              <!-- Single Widget-->
              <div class="col-12 col-sm-6 col-lg">
                <div class="single-footer-widget section_padding_0_130">
                  <!-- Widget Title-->
                  <h5 class="widget-title">Contact</h5>
                  <!-- Footer Menu-->
                  <div class="footer_menu">
                    <ul>
                      <li><a href="#">Call Centre</a></li>
                      <li><a href="#">Email Us</a></li>
                      <li><a href="#">Term &amp; Conditions</a></li>
                      <li><a href="#">Help Center</a></li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </footer>
    <!-- jQueryÏôÄ bootstrap Ï†ÅÏö©-->
    <!--jQueryÎäî bootstrapÏùò jsÍ∞Ä ÏÇ¨Ïö©ÌïòÎØÄÎ°ú bootstrap js ÌååÏùº Î°úÎìú Ï†Ñ Î°úÎìúÌïúÎã§.-->
    <script src="../jQuery/jquery-3.7.1.js"></script>
    <!-- <body> ÌÉúÍ∑∏Í∞Ä ÎÅùÎÇòÍ∏∞ Ï†Ñ js ÌååÏùº Î°úÎìú Ïãú Ïõπ ÌéòÏù¥ÏßÄ Î°úÎî© ÏÜçÎèÑ Ìñ•ÏÉÅÎêúÎã§.-->
    <script src="../bootstrap-4.6.2-dist/js/bootstrap.js"></script>
<script>
  document.getElementById('newThreadBtn').addEventListener('click', function() {
      // ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Î∞úÏÉù Ïãú forumWriting.htmlÎ°ú ÌéòÏù¥ÏßÄ Ïù¥Îèô
      window.location.href = 'forumWriting.html';
  });
</script>
                     <!-- Î≤ÑÌäº ÌÅ¥Î¶≠Ïãú Î°úÍ∑∏Ïù∏ ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô-->
                     <script>
                      function goToSignin(){
                        window.location.href = "http://52.79.41.79/OkeyDokey/signin.html";
                      }
                      </script>
                      <!-- Î≤ÑÌäº ÌÅ¥Î¶≠Ïãú ÌöåÏõêÍ∞ÄÏûÖ ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô-->
                    <script>
                      function goToSignup(){
                        window.location.href = "http://52.79.41.79/OkeyDokey/signup.html";
                      }
                      </script>
</body>
</html>