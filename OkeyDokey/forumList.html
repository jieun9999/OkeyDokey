<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>forumList</title>
        <!--í°íŠ¸ ì ìš©-->
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Varela+Round">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Kalam:wght@300;400;700&family=Noto+Sans+KR:wght@300&family=Open+Sans:ital@1&display=swap" rel="stylesheet">
        <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <!-- ê°€ì¥ê¸°ë³¸ì´ ë˜ëŠ” css ì½”ë“œ-->
    <link rel="stylesheet" href="../bootstrap-4.6.2-dist/css/bootstrap.css">
    <link rel="stylesheet" href="forumList.css">
</head>
<body>
  <?php
  //ì´ë ‡ê²Œ í•˜ë©´ ë¸Œë¼ìš°ì €ì— ì—ëŸ¬ ë©”ì‹œì§€ê°€ í‘œì‹œë©ë‹ˆë‹¤. 
  error_reporting(E_ALL);
  ini_set('display_errors', 1);

  // í˜ì´ì§•
  //í˜ì´ì§€ ë²ˆí˜¸ë¥¼ ë„˜ì–´ë‹¤ë‹ ë•ŒëŠ” GET ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•  ê²ƒì´ê¸° ë•Œë¬¸ì—, GETìœ¼ë¡œ ë„˜ì–´ì˜¬ pageë¥¼ ë°›ì•„ $pageì— í• ë‹¹í•´ì¤€ë‹¤.
  if(isset($_GET['page'])){
    $page = $_GET['page'];
    }else{
      $page = 1;
    }

  // ê²€ìƒ‰ ê¸°ëŠ¥  
  // ìƒˆë¡œìš´ ê²€ìƒ‰ì–´ë¥¼ ë°›ì•„ì˜´
  // url í‘œê¸°ë•Œë¬¸ì— ""ë¡œ ê¸°ë³¸ê°’ í• ë‹¹
  $searchTerm = isset($_GET['search']) ? $_GET['search'] : "";

  // ì •ë ¬ìˆœì„œ ì¿ í‚¤
  // ìµœì‹ ìˆœ or ì¡°íšŒìˆœ or ì¶”ì²œìˆœ ì •ë ¬ ìˆœì„œë¥¼ í™•ì¸
  $sortOrder = isset($_GET['sort'])? $_GET['sort']: 'latest';

  //1. mysqlê³¼ ì—°ê²°í•˜ê¸°
  include 'config_mysqli.php';

  //2. SELECT ì¿¼ë¦¬ ì „ì†¡ 
  /* joinì‚¬ìš©í•´ì„œ forums í…Œì´ë¸”ê³¼ answers í…Œì´ë¸”ì˜ ë°ì´í„°ë¥¼ í•œë²ˆì— ê°€ì ¸ì˜¨ë‹¤ */

  // ê²Œì‹œê¸€ í˜ì´ì§•
  //mysqli_num_rows() í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ ê²Œì‹œê¸€ì˜ ì´ ê°œìˆ˜ë¥¼ ì•Œì•„ë‚´ ë³€ìˆ˜ì— í• ë‹¹í•´ì¤€ë‹¤.
  $sqlNum = "SELECT * FROM forums";
  $res = mysqli_query($connect, $sqlNum);
 
  $per = 5;
  //í•œ í˜ì´ì§€ ë‹¹ ì¶œë ¥í•  ê²Œì‹œê¸€ì˜ ê°œìˆ˜ë¥¼ ì •í•´ì¤€ë‹¤

  $start = ($page-1)*$per + 1;
  // ë§¤ í˜ì´ì§€ë¥¼ ì‹œì‘í•  ê²Œì‹œê¸€ì˜ ë²ˆí˜¸ë¥¼ ì •í•´ì¤€ë‹¤.

  $start -= 1;
  // LIMITë¥¼ ì‚¬ìš©í•´ ê²°ê³¼ê°’ì„ ì œí•œí•˜ì—¬ ê²°ê³¼ì ìœ¼ë¡œ ê²Œì‹œê¸€ì„ ì˜ë¼ì¤„ ê²ƒì´ê¸° ë•Œë¬¸ì—,limitì˜ ìš©ë²•ì— ë§ì¶° ì‹œì‘ê°’ì„ ì¡°ì •í•´ì¤€ë‹¤.
  // LIMITì˜ ì‹œì‘ í–‰ì€ 1ì´ ì•„ë‹ˆë¼ 0ì´ê¸° ë•Œë¬¸ì— $startì—ì„œ 1ì„ ë¹¼ì£¼ëŠ” ê²ƒì´ë‹¤.



  $sql = "SELECT forums.forumTitle, forums.userId, forums.forumDate, forums.forumId AS FI, /*forums.forumIdëŠ” ì•„ë˜ì—ì„œ ë Œë”ë§í•´ì•¼í•˜ë‹ˆ ë³„ì¹­ ì •í•´ì¤Œ */
  answers.userId, answers.answerDate, users.userImg, users.userName, users2.userName AS forumUserName,
 /* ì„œë¸Œì¿¼ë¦¬ COUNT í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ì„œ forumIdì— ëŒ€í•œ answers í…Œì´ë¸”ì˜ í–‰ì˜ ê°¯ìˆ˜ ê°€ì ¸ì˜¤ê¸° */
  (
    SELECT COUNT(*)
    FROM answers
    WHERE answers.forumId = forums.forumId
  ) AS answerCount

  /* í•œìª½ í…Œì´ë¸”(answers)ê°€ ì—†ëŠ” ê²½ìš°ì—ë„ ë Œë”ë§ ë  ìˆ˜ ìˆë„ë¡ LEFT JOIN ì‚¬ìš©í•˜ê¸° */
        FROM forums
        
        /* LEFT JOIN ì ˆì—ì„œ ì¡°ê±´ë¬¸ì„ ì‚¬ìš©í•˜ê³  ìˆë‹¤. */
        /* ë‹µë³€ì´ ì—†ëŠ” ê²½ìš°ì—ëŠ” answers í…Œì´ë¸”ì˜ í•´ë‹¹ ì¹¼ëŸ¼ë“¤ì€ NULLë¡œ ì±„ì›Œì§‘ë‹ˆë‹¤. */
        LEFT JOIN answers ON forums.forumId = answers.forumId
        AND answers.answerId = (
              SELECT MAX(answerId)
              FROM answers
              WHERE answers.forumId = forums.forumId
        )
        
        /* WHERE ì ˆì€ ì¿¼ë¦¬ì—ì„œ ì¡°ê±´ì„ ì§€ì •í•˜ì—¬ íŠ¹ì • í–‰ì„ ì„ íƒí•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤ */
        /* í•œê°œì˜ forumì— ì—¬ëŸ¬ê°œì˜ answers ê°€ ë‹¬ë¦¬ëŠ” ê²½ìš°, ì¤‘ë³µëœ í–‰ì´ ìƒê¸°ëŠ” ë¬¸ì œê°€ ë°œìƒ => ì—¬ëŸ¬ í–‰ ì¤‘ì—ì„œ WHEREë¬¸ìœ¼ë¡œ í•˜ë‚˜ì˜ í–‰ì„ ì„ íƒ*/
        /* íŠ¹íˆ, WHERE ì ˆì€ ì£¼ë¡œ SELECT, UPDATE, DELETE ë“±ì˜ ëª…ë ¹ë¬¸ê³¼ ìì£¼ ì“°ì…ë‹ˆë‹¤*/

        LEFT JOIN users ON answers.userId = users.userId 
        LEFT JOIN users AS users2 ON forums.userId = users2.userId"; /* usersí…Œì´ë¸” ê²¹ì¹˜ë‹ˆê¹Œ ë³„ì¹­ì‚¬ìš©í•¨ */

       // ê²€ìƒ‰ì–´ê°€ ë¹„ì–´ìˆì§€ ì•Šë‹¤ë©´(""ê°€ ì•„ë‹ˆë¼ë©´) ì¿¼ë¦¬ì— ì¶”ê°€í•©ë‹ˆë‹¤.
       // WHERE ì ˆ ë¬¸ìì—´ì„ ë”í•´ì„œ, ê²€ìƒ‰ë‹¨ì–´ê°€ í¬í•¨ëœ ê¸€ ì œëª©ë“¤ë§Œ ë³´ì—¬ì¤Œ
       if ($searchTerm !== "") {
        //mysqli_num_rows() í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ ê²Œì‹œê¸€ì˜ ì´ ê°œìˆ˜ë¥¼ ë‹¤ì‹œ ì„¤ì •í•´ì¤€ë‹¤
        $sqlNum = "SELECT * FROM forums WHERE forums.forumTitle LIKE '%$searchTerm%'";
        $res = mysqli_query($connect, $sqlNum);
        $sql .= " WHERE forums.forumTitle LIKE '%$searchTerm%'";
       }
       // '%$searchTerm%'ëŠ” ê²€ìƒ‰ì–´ê°€ í¬í•¨ëœ ë¶€ë¶„ ë¬¸ìì—´ì„ ì°¾ìŠµë‹ˆë‹¤.


        //ì¿ í‚¤ì— ë”°ë¼ì„œ ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½
        $btnText ='ì •ë ¬ ìˆœì„œ';

        //ì‚¬ìš©ìì˜ ì„ íƒ($sortOrder)ì— ë”°ë¼ ì •ë ¬ ìˆœì„œê°€ ì¦‰ì‹œ ê²°ì •ë˜ê³  ê·¸ì— ë”°ë¼ í•´ë‹¹ SQL ì¿¼ë¦¬ê°€ êµ¬ì„±ë˜ê²Œ í•¨
        // $sortOrder ì— ìœ ì € ë²„íŠ¼í´ë¦­ì— ë”°ë¼ ê°’ì„ ê·¸ë•Œ ê·¸ë•Œ í• ë‹¹í•˜ê¸° ë•Œë¬¸ì—, ì¿ í‚¤ê°€ ë¶ˆí•„ìš”í•˜ë‹¤

        if($sortOrder === 'views'){
          $sql.= " ORDER BY forums.forumHits DESC";
          $btnText ='ì¡°íšŒìˆœ';
          /* ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ ê¸€ëª©ë¡ ë²ˆí˜¸ ê°€ì ¸ì˜´ */

        }elseif($sortOrder === 'likes'){
          $sql.= " ORDER BY forums.forumVotingCounts DESC";
          $btnText ='ì¶”ì²œìˆœ';

        }else{
          $sql.= " ORDER BY forums.forumDate DESC";
          $btnText ='ìµœì‹ ìˆœ';
        }
       
        // í˜ì´ì§• ì¿¼ë¦¬ 
        $sql.=" LIMIT $start, $per";


  $result=$connect->query($sql);

  ?>
    <!--ë”°ì˜¨ ì½”ë“œ ë„£ê¸°-->
    <!-- Nav-->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
         <!-- Logo -->
    <a class="navbar-brand" href="http://52.79.41.79/OkeyDokey/forumList.html">
        <img src="../img/okeydokey1.png" class="h-8" alt="..">
    </a>
    
    <!-- ì„¸ì…˜ ì‹œì‘ -->
    <?php 

        session_name('ë¡œê·¸ì¸ì„¸ì…˜');
        session_start(); //ì„¸ì…˜ì‹œì‘

    ?>

    <!-- ë¡œê·¸ì¸ ì„¸ì…˜ ë°ì´í„°ê°€ ìˆë‹¤ë©´, userName ê³¼ logout ë²„íŠ¼ì„ ë³´ì—¬ì£¼ê³ ,-->
    <!-- ë¡œê·¸ì¸ ì„¸ì…˜ ë°ì´í„°ê°€ ì—†ë‹¤ë©´, ê¸°ì¡´ì²˜ëŸ¼ signin ê³¼ signup ë²„íŠ¼ì„ ë³´ì—¬ì¤€ë‹¤ -->

          <div class="navbar-nav ml-auto action-buttons">
            <?php
            if(isset($_SESSION['userId']) && isset($_SESSION['userName'])){
              // ë¡œê·¸ì¸ ì„¸ì…˜ ë°ì´í„°ê°€ ìˆë‹¤ë©´

              echo '<div class="login_name" onclick="goToProfile()">'.$_SESSION['userName'].'ë‹˜</div>';

              echo '<div class="nav-item dropdown" onclick="goToLogout()">';
              echo '<a href="#" class="btn btn-primary dropdown-toggle sign-up-btn">Logout</a>';
              echo '</div>';

            }else{
              // ë¡œê·¸ì¸ ì„¸ì…˜ ë°ì´í„°ê°€ ì—†ë‹¤ë©´

              echo '<div class="nav-item dropdown" onclick="goToSignin()">';
              echo '<a href="#" class="nav-link dropdown-toggle mr-4">Login</a>';
              echo '</div>';
              echo '<div class="nav-item dropdown" onclick="goToSignup()">';
              echo '<a href="#" class="btn btn-primary dropdown-toggle sign-up-btn">Sign up</a>';
              echo '</div>';

            }
            ?> 
          </div>
        </div>
    </nav>

    <!-- Main-->
    <div class="container-fluid mt-100">
      <!--new thread ë²„íŠ¼ -->
        <button type="button" class="btn btn-shadow btn-wide btn-primary" id="newThreadBtn"> 
          <div class="newThreadBtnTxt"><i class="fa fa-plus fa-w-20"></i> New thread</div>
        </button>

    <div class="d-flex flex-wrap justify-content-between">
    <!-- Example single danger button -->
    <div class="btn-group">
      <button type="button" class="btn btn-warning dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
        <!-- PHPë¡œ ì¿ í‚¤ ê°’ì„ ì½ì–´ì™€ì„œ ì¡°ê±´ì— ë”°ë¼ ì´ˆê¸° ë²„íŠ¼ í…ìŠ¤íŠ¸ë¥¼ ì„¤ì •í•˜ëŠ” ë°©ë²• -->
        <!-- ì´ˆê¸° ë²„íŠ¼ í…ìŠ¤íŠ¸ -->
        <?php echo $btnText ?>
      </button>
      <!-- hrefì˜ '?key=value' íŒŒë¼ë¯¸í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ì„œ get ìš”ì²­ì„ ë³´ëƒ„ -->
      <!-- onclick ì´ë²¤íŠ¸ì—ì„œ ë²„íŠ¼ í…ìŠ¤íŠ¸ë¥¼ ë³€ê²½-->
      <!-- $searchTerm ì€ php ì½”ë“œë¼ ê°ì‹¸ì£¼ê¸° -->
      <div class="dropdown-menu">
        <a class="dropdown-item" href="?page=1&sort=latest&search=<?php echo $searchTerm; ?>">ìµœì‹ ìˆœ</a>
        <div class="dropdown-divider"></div>
        <a class="dropdown-item" href="?page=1&sort=views&search=<?php echo $searchTerm; ?>">ì¡°íšŒìˆœ</a>
        <div class="dropdown-divider"></div>
        <a class="dropdown-item" href="?page=1&sort=likes&search=<?php echo $searchTerm; ?>">ì¶”ì²œìˆœ</a>
      </div>
    </div>

    <!-- ê²€ìƒ‰ì°½ ì¿ í‚¤ -->
      <?php

      //ê²€ìƒ‰ì–´ê°€ ë¹„ì–´ìˆì§€ ì•Šë‹¤ë©´ ì¿ í‚¤ì— ì €ì¥
      if(!empty($searchTerm)){

        // ê¸°ì¡´ì˜ ì €ì¥ëœ ê²€ìƒ‰ì–´ë“¤ì„ ì½ì–´ì˜´
        $history = isset($_COOKIE['searchTerm_history']) ? $_COOKIE['searchTerm_history'] : '';

        // ì¿ í‚¤ì— ì €ì¥ëœ ê¸°ì¡´ ê¸°ë¡ë“¤ì„ ë¬¸ìì—´ì—ì„œ ë°°ì—´ë¡œ ë³€í™˜
        $terms = ($history) ? explode(',', $history): [];

        // ìƒˆë¡œìš´ ê²€ìƒ‰ì–´ë¥¼ ë°°ì—´ì— ì¶”ê°€
        //array_unshift ëŠ” ë°°ì—´ì˜ ì²«ë²ˆì§¸ ìë¦¬ì— ê°’ì„ ì…ë ¥í•˜ê³  ë°°ì—´ì˜ í¬ê¸°ë¥¼ ëŒë ¤ì£¼ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤.
        array_unshift($terms, $searchTerm);

        // ë°°ì—´ ì¤‘ ì¤‘ë³µëœ ê²€ìƒ‰ì–´ ì œê±°
        $terms = array_unique($terms);

        // $terms ë°°ì—´ì„ ì½¤ë§ˆ(',')ë¡œ ì´ì–´ë¶™ì—¬ ë¬¸ìì—´ë¡œ ë§Œë“¤ê³ , ì¿ í‚¤ì— ì €ì¥
        //setcookie("ì¿ í‚¤ëª…", "ì¿ í‚¤ ê°’", "íê¸° ì‹œê°„", "ê²½ë¡œ");
        setcookie('searchTerm_history', implode(',', $terms), time()+ 3600);
    }
    
    // ë‹¤ì‹œ ì¿ í‚¤ì—ì„œ ì½ì–´ì˜´
    $history =  isset($_COOKIE['searchTerm_history']) ? $_COOKIE['searchTerm_history'] : '';

    ?>

      <!-- ê²€ìƒ‰ì°½ -->
      <!-- nameì„ keyë¡œ í•˜ê³ , typeì„ valueë¡œ í•´ì„œ ë³´ë‚¸ë‹¤ -->
      <div class="col-12 col-md-3 p-0 mb-3">
      <!-- autocomplete="off"ë¥¼ ì¶”ê°€í•˜ì—¬ ìë™ ì™„ì„±ì„ ë¹„í™œì„±í™” -->
      <form class="search-form" method="GET" action="/OkeyDokey/forumList.html" autocomplete="off">

        <!-- datalist ìš”ì†Œë¥¼ ì‚¬ìš©í•˜ì—¬ ê²€ìƒ‰ ê¸°ë¡ì„ ë“œë¡­ë‹¤ìš´ìœ¼ë¡œ ë³´ì—¬ì¤Œ-->
        <!-- ë§Œì•½  $searchTermì´ ""ê°€ ì•„ë‹ˆë¼ë©´, placeholder ëŒ€ì‹ ì— input ìœ„ì— ê°’ìœ¼ë¡œ ë„ì›Œì£¼ê³  ì‹¶ì–´ -->
          <input list="searchHistoryList" name="search" type="text" class="form-control" placeholder="<?php echo $searchTerm !== "" ? $searchTerm : 'Search by title'; ?>"></input> 
          <input type="submit" value="click!"/>
            <datalist id="searchHistoryList">
              
              <?php
              if($history){
                // ì €ì¥ëœ ê²€ìƒ‰ ê¸°ë¡ì„ ì½¤ë§ˆ(,)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë¶„ë¦¬í•˜ì—¬ ë°°ì—´ë¡œ ë§Œë“­ë‹ˆë‹¤
                $terms = explode(',', $history);

                // ê° ê²€ìƒ‰ì–´ì— ëŒ€í•´ <option> ìš”ì†Œë¥¼ ìƒì„±í•˜ì—¬ ì¶œë ¥í•©ë‹ˆë‹¤
                foreach($terms as $term){
                  // ìŠ¬ë˜ì‹œ (\")ëŠ” ì´ìŠ¤ì¼€ì´í”„ ë¬¸ìì…ë‹ˆë‹¤. ì´ìŠ¤ì¼€ì´í”„ ë¬¸ìë¥¼ ì‚¬ìš©í•˜ë©´ íŠ¹ìˆ˜ ë¬¸ìë¥¼ ë¬¸ìì—´ ì•ˆì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                  echo "<option value=\"$term\">";
                }
              }

              ?>
            </datalist>

      </form>
      </div>

      </div>

      <div class="card mb-3">
      <div class="card-header pl-0 pr-0">
      <div class="row no-gutters w-100 align-items-center">
      <div class="col ml-3">Topics</div>
      <div class="col-4 text-muted">
      <div class="row no-gutters align-items-center">
      <div class="col-4">Answers</div>
      <div class="col-8">Last update</div>
      </div>
      </div>
      </div>
      </div>

      <!--dbì—ì„œ ë°ì´í„° ê°€ì ¸ì˜´-->
      <?php
      //3. ê°€ì ¸ì˜¨ ë°ì´í„°ë¡œ ëª©ì°¨ ìƒì„±

      //while ë°˜ë³µë¬¸ì€ mysql ê²°ê³¼ ì§‘í•©ì—ì„œ ê° í–‰ì„ í•˜ë‚˜ì”© ê°€ì ¸ì™€ì„œ html ëª©ì°¨ë¥¼ ë™ì ìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤.
      //ì´ë•Œ, 'fetch_assoc()' í•¨ìˆ˜ë¥¼ í†µí•´  MySQL ê²°ê³¼ ì§‘í•©ì˜ í•œ í–‰ì„ ì—°ê´€ë°°ì—´(associative array)ë¡œ ê°€ì ¸ì˜µë‹ˆë‹¤ 

      while($rows = mysqli_fetch_assoc($result)){
        ?>
        <div class="card-body py-3">
        <div class="row no-gutters align-items-center">
        <div class="col">
          <!-- ì´ë•Œ, ?ë’¤ì˜ íŒŒë¼ë¯¸í„°ì˜ í‚¤ëŠ” ë¬´ì¡°ê±´ ìœ ì¼í•´ì•¼ í•œë‹¤. ë”°ë¼ì„œ í•œë²ˆì“´ ë‹¨ì–´ì¸ forumIdëŠ” ì“°ì§€ ì•Šë„ë¡ í•œë‹¤! -->
          <a href="http://52.79.41.79/OkeyDokey/forumSpecific.html?ê¸€ì•„ì´ë””=<?php echo $rows['FI']?>" class="text-big" data-abc="true"><?php echo $rows['forumTitle']?></a>
          <!--forums í…Œì´ë¸”ì˜ userId í–‰ì˜ userNameì´ ë“¤ì–´ê°€ì•¼ í•¨-->
        <div class="text-muted small mt-1">Started <?php echo $rows['forumDate']?> &nbsp;Â·&nbsp; <a href="javascript:void(0)" class="text-muted" data-abc="true"><?php echo $rows['forumUserName']?></a></div>
        </div>
        <div class="d-none d-md-block col-4">
        <div class="row no-gutters align-items-center">
          <!-- answerCount ë¶€ë¶„ì€ ê° forumIdì— ëŒ€í•œ answers í…Œì´ë¸” í–‰ì˜ ê°¯ìˆ˜ë¥¼ ì˜ë¯¸í•œë‹¤-->
        <div class="col-4"><?php echo $rows['answerCount']?></div>
          <!-- answerCountê°€ 0ë³´ë‹¤ í¬ë©´, ë‹µë³€ìì˜ í”„ë¡œí•„ì´ ë³´ì´ë„ë¡, ë‹µë³€xì¸ ê²½ìš°ì—ëŠ” waiting for ì¶œë ¥ -->
        <?php if($rows['answerCount'] > 0): ?>
        <div class="media col-8 align-items-center"> <img src="<?php echo $rows['userImg']?>" alt="" class="d-block ui-w-30 rounded-circle">
        <div class="media-body flex-truncate ml-2">
        <div class="line-height-1 text-truncate"><?php echo $rows['answerDate']?></div>
        <div class="text-muted small text-truncate">by <?php echo $rows['userName']?></div>
        </div>
        </div>
        <?php else: ?>
          <!-- $rows['answerCount']ê°€ nullì¸ ê²½ìš° "waiting for you!" ì¶œë ¥ -->
          <div class="media col-8 align-items-center"> <img src="<?php echo $rows['userImg']?>" alt="" class="d-block ui-w-30 rounded-circle">
            waiting for you! ğŸ¤¯
            </div>
          <?php endif; ?>
        </div>
        </div>
        </div>
        </div>
        <hr class="m-0">
      <?php
        }
      // while ë¬¸ ë‹«ì•„ì£¼ê¸°
      ?>

      </div>
      <nav>
      <ul class="pagination mb-5">

        <?php

        // ê²€ìƒ‰ì–´ê°€ ìˆì„ ê²½ìš° ë Œë”ë§ê³¼ ì „ì²´í˜ì´ì§€ ë Œë”ë§ êµ¬ë¶„í•˜ê¸°
        
        // => mysqli_num_rows() í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ ê²Œì‹œê¸€ì˜ ì´ ê°œìˆ˜ë¥¼ ë‹¤ì‹œ ì„¤ì •í•´ì¤€ë‹¤
        $sqlNum = "SELECT * FROM forums WHERE forums.forumTitle LIKE '%$searchTerm%'";

          // 1. í˜ì´ì§€ ë²ˆí˜¸ ì¤‘ ì²˜ìŒ/ì´ì „ë²„íŠ¼ ì¶œë ¥
          // ì—¬ê¸°ì„œ \"ëŠ” í°ë”°ì˜´í‘œ(")ë¥¼ ë¬¸ìì—´ ë‚´ì—ì„œ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ì´ìŠ¤ì¼€ì´í”„ì…ë‹ˆë‹¤
          if($page >1 ){
            echo "<li class='page-item'><a class='page-link' href=\"forumList.html?page=1&sort=$sortOrder&search=$searchTerm\" data-abc='true'>[ì²˜ìŒ]</a></li>";
          }
  
          if($page >1 ){
            $pre = $page -1;
            echo "<li class='page-item'><a class='page-link' href=\"forumList.html?page=$pre&sort=$sortOrder&search=$searchTerm\" data-abc='true'>Â«</a></li>";
          }
          
  
          // 2. í˜ì´ì§€ ë²ˆí˜¸ ì¤‘ 1/2/3 ë“± ìˆ«ìë²„íŠ¼ ì¶œë ¥, + í˜„ì¬ ë²„íŠ¼ active 
          $total_post = mysqli_num_rows($res);
          $total_page = ceil($total_post/ $per);
          // ì´ í˜ì´ì§€ ê°œìˆ˜ëŠ” ceil() ì„ ì‚¬ìš©í•´ (ì´ ê²Œì‹œê¸€ ê°œìˆ˜ / í˜ì´ì§€ ë‹¹ ê²Œì‹œê¸€ ê°œìˆ˜) ë¥¼ ì˜¬ë¦¼í•´ì¤€ ê°’ ìœ¼ë¡œ ì •í•œë‹¤.
  
          $page_num = 1;
          while($page_num <= $total_page){
              if($page == $page_num){
                  echo "<li class='page-item active'><a class='page-link' href=\"forumList.html?page=$page_num&sort=$sortOrder&search=$searchTerm\" data-abc='true'>$page_num</a></li>";
              }
              else {
                echo "<li class='page-item'><a class='page-link' href=\"forumList.html?page=$page_num&sort=$sortOrder&search=$searchTerm\" data-abc='true'>$page_num</a></li>";
              }
                  $page_num++;
          }
  
          // 3. í˜ì´ì§€ ë²ˆí˜¸ ì¤‘ ë/ë‹¤ìŒë²„íŠ¼ ì¶œë ¥
          if($page < $total_page){
            $next = $page + 1;
            echo "<li class='page-item'><a class='page-link' href=\"forumList.html?page=$next&sort=$sortOrder&search=$searchTerm\" data-abc='true'>Â»</a></li>";
          }
          if($page < $total_page){
            echo "<li class='page-item'><a class='page-link' href=\"forumList.html?page=$total_page&sort=$sortOrder&search=$searchTerm\" data-abc='true'>[ë]</a></li>";
          }


        ?>

      </ul>
      </nav>
      </div> 


    <!-- Footer-->

    <footer class="footer_area section_padding_130_0">
          <div class="container">
            <div class="row">
              <!-- Single Widget-->
              <div class="col-12 col-sm-6 col-lg-4">
                <div class="single-footer-widget section_padding_0_130">
                  <!-- Footer Logo-->
                  <div class="footer-logo mb-3"></div>
                  <p>Appland is completely creative, lightweight, clean app landing page.</p>
                  <!-- Copywrite Text-->
                  <div class="copywrite-text mb-5">
                    <p class="mb-0">Made with <i class="lni-heart mr-1"></i>by<a class="ml-1" href="https://wrapbootstrap.com/user/DesigningWorld">Designing World</a></p>
                  </div>
                  <!-- Footer Social Area-->
                  <div class="footer_social_area"><a href="#" data-toggle="tooltip" data-placement="top" title="" data-original-title="Facebook"><i class="fa fa-facebook"></i></a><a href="#" data-toggle="tooltip" data-placement="top" title="" data-original-title="Pinterest"><i class="fa fa-pinterest"></i></a><a href="#" data-toggle="tooltip" data-placement="top" title="" data-original-title="Skype"><i class="fa fa-skype"></i></a><a href="#" data-toggle="tooltip" data-placement="top" title="" data-original-title="Twitter"><i class="fa fa-twitter"></i></a></div>
                </div>
              </div>
              <!-- Single Widget-->
              <div class="col-12 col-sm-6 col-lg">
                <div class="single-footer-widget section_padding_0_130">
                  <!-- Widget Title-->
                  <h5 class="widget-title">About</h5>
                  <!-- Footer Menu-->
                  <div class="footer_menu">
                    <ul>
                      <li><a href="#">About Us</a></li>
                      <li><a href="#">Corporate Sale</a></li>
                      <li><a href="#">Terms &amp; Policy</a></li>
                      <li><a href="#">Community</a></li>
                    </ul>
                  </div>
                </div>
              </div>
              <!-- Single Widget-->
              <div class="col-12 col-sm-6 col-lg">
                <div class="single-footer-widget section_padding_0_130">
                  <!-- Widget Title-->
                  <h5 class="widget-title">Support</h5>
                  <!-- Footer Menu-->
                  <div class="footer_menu">
                    <ul>
                      <li><a href="#">Help</a></li>
                      <li><a href="#">Support</a></li>
                      <li><a href="#">Privacy Policy</a></li>
                      <li><a href="#">Term &amp; Conditions</a></li>
                      <li><a href="#">Help &amp; Support</a></li>
                    </ul>
                  </div>
                </div>
              </div>
              <!-- Single Widget-->
              <div class="col-12 col-sm-6 col-lg">
                <div class="single-footer-widget section_padding_0_130">
                  <!-- Widget Title-->
                  <h5 class="widget-title">Contact</h5>
                  <!-- Footer Menu-->
                  <div class="footer_menu">
                    <ul>
                      <li><a href="#">Call Centre</a></li>
                      <li><a href="#">Email Us</a></li>
                      <li><a href="#">Term &amp; Conditions</a></li>
                      <li><a href="#">Help Center</a></li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </footer>
    <!-- jQueryì™€ bootstrap ì ìš©-->
    <!--jQueryëŠ” bootstrapì˜ jsê°€ ì‚¬ìš©í•˜ë¯€ë¡œ bootstrap js íŒŒì¼ ë¡œë“œ ì „ ë¡œë“œí•œë‹¤.-->
    <script src="../jQuery/jquery-3.7.1.js"></script>
    <!-- <body> íƒœê·¸ê°€ ëë‚˜ê¸° ì „ js íŒŒì¼ ë¡œë“œ ì‹œ ì›¹ í˜ì´ì§€ ë¡œë”© ì†ë„ í–¥ìƒëœë‹¤.-->
    <script src="../bootstrap-4.6.2-dist//js/bootstrap.bundle.js"></script>
<script>
  document.getElementById('newThreadBtn').addEventListener('click', function() {
      // í´ë¦­ ì´ë²¤íŠ¸ ë°œìƒ ì‹œ forumWriting.htmlë¡œ í˜ì´ì§€ ì´ë™
      window.location.href = 'forumWriting.html';
  });
</script>
  <!-- ë²„íŠ¼ í´ë¦­ì‹œ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™-->
  <script>
    function goToSignin(){
      window.location.href = "http://52.79.41.79/OkeyDokey/signin.html";
      }
  </script>
  <!-- ë²„íŠ¼ í´ë¦­ì‹œ íšŒì›ê°€ì… í˜ì´ì§€ë¡œ ì´ë™-->
    <script>
    function goToSignup(){
      window.location.href = "http://52.79.41.79/OkeyDokey/signup.html";
      }
    </script> 
  <!-- ë²„íŠ¼ í´ë¦­ì‹œ ë¡œê·¸ì•„ì›ƒ í˜ì´ì§€ë¡œ ì´ë™-->
  <script>
    function goToLogout(){
      window.location.href = "http://52.79.41.79/OkeyDokey/check_logout.php";
    }

    // 00ë‹˜ì„ ëˆ„ë¥´ë©´,  í”„ë¡œí•„ ìˆ˜ì • í˜ì´ì§€ë¡œ ì´ë™
    function goToProfile(){
      window.location.href = "profileEdit.html";
    } 
  </script>                
</body>
</html>